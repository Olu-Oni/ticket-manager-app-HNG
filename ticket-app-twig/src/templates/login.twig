{% extends 'components/layout.twig' %}

{% block content %}
	<main class="w-full bg-[var(--background)] flex justify-center items-center text-left grow">
		<form id="loginForm" novalidate class="max-w-md my-4 mx-auto p-6 bg-transparent border-3 border-[var(--secondary)] rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-center mb-6">Log In</h2>

            <div class="space-y-5 mb-6">
                <!-- Email -->
                <div class="form-group">
                    <label for="email" class="block text-sm font-medium text-[var(--primary-300)] mb-1">
                        Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" id="email" required aria-describedby="error-email"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent)] transition"
                        placeholder="you@example.com">
                    <span id="error-email" class="error text-red-500 text-sm mt-1 block min-h-5" role="alert"></span>
                </div>

                <!-- Password -->
                <div class="form-group">
                    <label for="password" class="block text-sm font-medium text-[var(--primary-300)] mb-1">
                        Password <span class="text-red-500">*</span>
                    </label>
                    <input type="password" id="password" required aria-describedby="error-password"
                        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--accent)] transition"
                        placeholder="••••••••">
                    <span id="error-password" class="error text-red-500 text-sm mt-1 block min-h-5" role="alert"></span>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full btn-2">Log In</button>

            <p class="text-sm mt-4 text-center flex w-full place-content-center">
                Don't have an account? <a href="?route=auth/signup" class="text-[var(--primary-light)] hover:text-[var(--accent-hover)]">&nbsp; create a new account</a>
            </p>
        </form>
	</main>

	<script>


document.addEventListener('DOMContentLoaded', () => {
const form = document.getElementById('loginForm');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const errorEmail = document.getElementById('error-email');
const errorPassword = document.getElementById('error-password');

// Form state
let formData = {
email: '',
password: ''
};
let errors = {
email: '',
password: ''
};

// Handle input change + clear error
const handleChange = (field) => (e) => {
formData[field] = e.target.value;
errors[field] = '';
document.getElementById (`error-${field}`).textContent = '';
};

// Validation
const validate = () => {
errors = {
email: '',
password: ''
};
if (! formData.email.trim()) 
errors.email = 'Email is required';


if (! formData.password) 
errors.password = 'Password is required';


errorEmail.textContent = errors.email;
errorPassword.textContent = errors.password;
return Object.values(errors).every(err => !err);
};

// Submit handler
const handleSubmit = (e) => {
e.preventDefault();
if (! validate()) {
notyf.error('Login failed: missing email/password');
return;
}

const result = window.login(formData.email, formData.password);
if (result.success) {
notyf.success(result.message);
formData = {
email: '',
password: ''
};
emailInput.value = '';
passwordInput.value = '';
errors = {
email: '',
password: ''
};
setTimeout(() => {
window.location.href = '?route=dashboard';
}, 1500);
} else {
notyf.error(result.message);
}
};

// Event listeners
emailInput.addEventListener('input', handleChange('email'));
passwordInput.addEventListener('input', handleChange('password'));
form.addEventListener('submit', handleSubmit);

// Focus first input on mount
emailInput.focus();
});
	</script>
{% endblock %}
